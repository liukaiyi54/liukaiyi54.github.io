<!DOCTYPE html>
<html>
  	<head>
  		<title>Michael's blog</title>
  		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
  		<meta name="description" content="" />
  		<meta name="keywords" content="" />
  		<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
  		<script src="/js/jquery.min.js"></script>
  		<script src="/js/jquery.poptrox.min.js"></script>
  		<script src="/js/skel.min.js"></script>
  		<script src="/js/init.js"></script>
  		<noscript>
  			<link rel="stylesheet" href="/css/skel.css" />
  			<link rel="stylesheet" href="/css/style.css" />
  			<link rel="stylesheet" href="/css/style-xlarge.css" />
  		</noscript>
  		<!--[if lte IE 8]><link rel="stylesheet" href="/css/ie/v8.css" /><![endif]-->
  	</head>

	<body id="top">

      <header id="header">
          <center><a href="/" class="image avatar"><img src="/images/avatar.jpg" alt="" /></a></center>
          <center><h1>This is Michael's <strong><a href="/">blog</a></strong>, where<br />
          he probably puts everything on</center><br />
<!--           crafted by <a href="http://html5up.net">HTML5 UP</a>. -->
          </h1>
      </header>


        <div id="main">
    <article>
        <header class="major">
            <h2 class="post-title">用KVC来修改系统类的私有属性</h2>
                <p class="post-meta">Apr 1, 2016 posted by 凯一</p>
        </header>

        <section>
            <h3 id="kvc">用KVC来修改系统类的私有属性</h3>

<h4 id="section">1. 获得私有属性</h4>

<p>获得私有属性需要用到runtime, 代码如下, 具体每个函数用途就不解释了, 顾名思义即可.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	unsigned int count = 0;
	Ivar *ivars = class_copyIvarList([UIPageControl class], &amp;count);
	for (int i = 0; i &lt; count; i++) {
		const char *name = ivar_getName(ivar[i]);
		const char *type = ivar_getTypeEncoding(ivars[i]);
		NSLog(@"%s----%s", name, type);
	}
</code></pre>
</div>
<p>这里是获取<code class="highlighter-rouge">UIPageControl</code>的所有属性列表. 运行结果如下:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>2016-04-01 15:17:05.283 rank[78962:7532230] _lastUserInterfaceIdiom-----q
2016-04-01 15:17:05.283 rank[78962:7532230] _indicators-----@"NSMutableArray"
2016-04-01 15:17:05.284 rank[78962:7532230] _currentPage-----q
2016-04-01 15:17:05.284 rank[78962:7532230] _displayedPage-----q
2016-04-01 15:17:05.284 rank[78962:7532230] _pageControlFlags-----{?="hideForSinglePage"b1"defersCurrentPageDisplay"b1}
2016-04-01 15:17:05.284 rank[78962:7532230] _currentPageImage-----@"UIImage"
2016-04-01 15:17:05.284 rank[78962:7532230] _pageImage-----@"UIImage"
2016-04-01 15:17:05.284 rank[78962:7532230] _currentPageImages-----@"NSMutableArray"
2016-04-01 15:17:05.285 rank[78962:7532230] _pageImages-----@"NSMutableArray"
2016-04-01 15:17:05.285 rank[78962:7532230] _backgroundVisualEffectView-----@"UIVisualEffectView"
2016-04-01 15:17:05.285 rank[78962:7532230] _currentPageIndicatorTintColor-----@"UIColor"
2016-04-01 15:17:05.285 rank[78962:7532230] _pageIndicatorTintColor-----@"UIColor"
2016-04-01 15:17:05.285 rank[78962:7532230] _legibilitySettings-----@"_UILegibilitySettings"
2016-04-01 15:17:05.285 rank[78962:7532230] _numberOfPages-----q
</code></pre>
</div>

<p>这里面有<code class="highlighter-rouge">_currentPageImage</code>和<code class="highlighter-rouge">_pageImage</code>这两个属性, 类型是<code class="highlighter-rouge">UIImage</code>可以让我们通过修改它们来自定义pageControl的式样.</p>

<h4 id="kvc-1">2.通过KVC来修改属性</h4>

<p>废话不说了, 直接上代码</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	UIPageControl *pageControl = [[UIPageControl alloc] init];
	[pageControl setValue:[UIImage imageNamed:@"your_image"] forKey:@"_pageImage"];
	[pageControl setValue:[UIImage imageNamed:@"your_another_image"] forKey:@"_currentPageImage"];
</code></pre>
</div>

<h4 id="section-1">3.其他</h4>

<p>多说两句. 除了获取私有属性外, 还可以获取私有方法.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	unsigned int count = 0;
	Method *memberFuncs = class_copyMethodList([UIPageControl class], &amp;count);

	for (int i = 0; i &lt; count; i++) {
		SEL method_name = method_getName(memberFuncs[i]);
		const char *name = sel_getName(method_name);
		NSLog(@"%s", name);
	}
</code></pre>
</div>
<blockquote>
  <p>Method: typedef struct objc_method *Method; <br />
 Method是runtime中定义的一个宏, 关于runtime的这些基础知识, 完了再做一次整理吧.</p>
</blockquote>

<p>利用这个函数, 可以添加方法. 效果和用Category一样.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>BOOL class_addMethod(Class cls, SEL name, IMP imp, const char *types)
</code></pre>
</div>
<p>其中</p>

<p><code class="highlighter-rouge">cls</code>:你要给哪个类添加方法</p>

<p><code class="highlighter-rouge">name</code>:你要添加的方法叫什么</p>

<p><code class="highlighter-rouge">imp</code>:你要添加的方法的实现叫什么, 这个方法必须至少有<code class="highlighter-rouge">self</code>和<code class="highlighter-rouge">_cmd</code>两个参数</p>

<p><code class="highlighter-rouge">types</code>: 一个字符数组, 用来描述方法参数的类型. 因为这个方法至少有<code class="highlighter-rouge">self</code>和<code class="highlighter-rouge">_cmd</code>两个参数, 所以第二个和第三个字符必须是”@:”. 第一个字符是返回值得类型. 具体参考<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html">Type Encodings</a></p>

        </section>
        
<!--         <footer> -->
<!--             <div class="row"> -->
<!--              -->
<!--              -->
<!--                 <article class="6u 12u(small) excerpt"> -->
<!--                     <header> -->
<!--                         <h2><a href="/2016/03/29/finally.html">Finally</a></h2> -->
<!--                     </header> -->
<!--                     <section> -->
<!--                         <p><img src="/images/fulls/01.jpg" class="fit image" /></p>

 -->
<!--                     </section> -->
<!--                     <footer> -->
<!--                         <ul class="actions"> -->
<!--                             <li><a href="/2016/03/29/finally.html" class="button">Read More</a></li> -->
<!--                         </ul> -->
<!--                     </footer> -->
<!--                 </article> -->
<!--              -->
<!--              -->
<!--              -->
<!--             </div> -->
<!--         </footer> -->

    </article>

</div>


        <!-- Footer -->
        <footer id="footer">
            <ul class="icons">
            <center>

              
              <li>
                <a href="https://github.com/liukaiyi54" class="icon fa-github">
                  <span class="label">GitHub</span>
                </a>
              </li>
              

              
              <li>
                <a href="https://twitter.com/liukaiyi54" class="icon fa-twitter">
                  <span class="label">Twitter</span>
                </a>
              </li>
              
              
              
              <li>
                <a href="http://weibo.com/liukaiyi54" class="icon fa-weibo">
                  <span class="label">Weibo</span>
                </a>
              </li>
              

              

              

              

              

              
              <li>
                <a href="mailto:liukaiyi54@gmail.com" class="icon fa-envelope-o">
                  <span class="label">Email</span>
                </a>
              </li>
              
            </ul>
            <ul class="copyright">
<!--                 <li>&copy; Untitled</li> -->
<!--                 <li>Design: <a href="http://html5up.net">HTML5 UP</a></li> -->
<!--                 <li>Demo Images: <a href="https://unsplash.com/">Unsplash</a></li> -->
<!--                 <li>Jekyll Template: <a href="http://cloudcannon.com">Cloud Cannon</a></li> -->
            </center>
            </ul>
        </footer>

	</body>
</html>
